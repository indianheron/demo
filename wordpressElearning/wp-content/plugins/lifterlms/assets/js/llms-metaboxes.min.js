!function(t){t.fn.llmsCollapsible=function(){return this.on("click",".llms-collapsible-header",function(){var e=t(this).closest(".llms-collapsible"),a=e.siblings(".llms-collapsible");e.toggleClass("opened"),e.find(".llms-collapsible-body").slideToggle(400),a.each(function(){t(this).removeClass("opened"),t(this).find(".llms-collapsible-body").slideUp(400)})}),this},window.llms=window.llms||{};var e=function(){this.init=function(){var e=this;if(t(".llms-select2").llmsSelect2({width:"100%"}),t(".llms-select2-post").each(function(){e.post_select(t(this))}),t(".llms-collapsible-group").llmsCollapsible(),this.bind_tabs(),t(".llms-datepicker").length&&this.bind_datepickers(),t('input[type="checkbox"][data-controls]').length&&this.bind_cb_controllers(),t("[data-is-controller]").length&&this.bind_controllers(),t(".llms-table").length&&this.bind_tables(),window.llms.post.post_type){var a="bind_"+window.llms.post.post_type;"function"==typeof this[a]&&this[a]()}t(".llms-merge-code-button").length&&this.bind_merge_code_buttons()},this.bind_cb_controllers=function(){t('input[type="checkbox"][data-controls]').each(function(){var e=t(this),a=t(e.attr("data-controls")).closest(".llms-mb-list");e.on("change",function(){t(this).is(":checked")?a.slideDown(200):a.slideUp(200)}),e.trigger("change")})},this.bind_controllers=function(){t("[data-is-controller]").each(function(){var e,a=t(this),n=t('[data-controller="#'+a.attr("id")+'"]');a.on("change",function(){e="checkbox"===a.attr("type")?a.is(":checked")?a.val():"false":a.val(),n.each(function(){var a=t(this).attr("data-controller-value"),n=[];-1!==a.indexOf(",")?n=a.split(","):n.push(a),-1!==n.indexOf(e)?t(this).slideDown(200):t(this).slideUp(200)})}),a.trigger("change")})},this.bind_datepickers=function(){t(".llms-datepicker").datepicker({dateFormat:"mm/dd/yy"})},this.bind_llms_engagement=function(){var e=this;t("#_llms_engagement_type").on("change",function(){t("#_llms_engagement").trigger("llms-engagement-type-change",t(this).val())}),t("#_llms_engagement").on("llms-engagement-type-change",function(a,n){var l=t(this);switch(n){case"achievement":case"certificate":case"email":var s="llms_"+n;l.val(null).attr("data-post-type",s).trigger("change"),e.post_select(l);break;default:l.trigger("llms-engagement-type-change-external",n)}})},this.bind_llms_membership=function(){t('a[href="#llms-course-remove"]').on("click",function(e){e.preventDefault();var a=t(this),n=a.closest("tr"),l=a.closest(".llms-mb-list");LLMS.Spinner.start(l),window.LLMS.Ajax.call({data:{action:"membership_remove_auto_enroll_course",course_id:a.attr("data-id")},beforeSend:function(){l.find("p.error").remove()},success:function(t){t.success?(n.fadeOut(200),setTimeout(function(){n.remove()},400)):l.prepend('<p class="error">'+t.message+"</p>"),LLMS.Spinner.stop(l)}})}),t('a[href="#llms-course-bulk-enroll"]').on("click",function(e){e.preventDefault();var a=t(this),n=(a.closest("tr"),a.closest(".llms-mb-list"));window.confirm(LLMS.l10n.translate("membership_bulk_enrollment_warning"))&&(LLMS.Spinner.start(n),window.LLMS.Ajax.call({data:{action:"bulk_enroll_membership_into_course",course_id:a.attr("data-id")},beforeSend:function(){n.find("p.error").remove()},success:function(t){t.success?a.replaceWith('<strong style="float:right;">'+t.data.message+"&nbsp;&nbsp;</strong>"):n.prepend('<p class="error">'+t.message+"</p>"),LLMS.Spinner.stop(n)}}))})},this.bind_llms_order=function(){t('button[name="llms-refund-toggle"]').on("click",function(){var e=t(this),a=e.closest("tr"),n=a.attr("data-transaction-id"),l=e.attr("data-refundable"),s="1"===e.attr("data-gateway-supports"),i=e.attr("data-gateway"),o=t("#llms-txn-refund-model .llms-txn-refund-form").clone(),r=o.find(".gateway-btn");"remove"!==e.attr("data-action")?(e.text(LLMS.l10n.translate("Cancel")),e.attr("data-action","remove"),o.find("input").removeAttr("disabled"),o.find('input[name="llms_refund_amount"]').attr("max",l),o.find('input[name="llms_refund_txn_id"]').val(n),s&&(r.find(".llms-gateway-title").text(i),r.show()),a.after(o)):(e.text(LLMS.l10n.translate("Refund")),e.attr("data-action",""),a.next("tr").remove())}),t('button[name="llms-manual-txn-toggle"]').on("click",function(){var e=t(this),a=e.closest("tr"),n=t("#llms-manual-txn-model .llms-manual-txn-form").clone();"remove"!==e.attr("data-action")?(e.text(LLMS.l10n.translate("Cancel")),e.attr("data-action","remove"),n.find("input").removeAttr("disabled"),a.after(n)):(e.text(LLMS.l10n.translate("Record a Manual Payment")),e.attr("data-action",""),a.next("tr").remove())})},this.bind_merge_code_buttons=function(){t(".llms-merge-code-button").on("click",function(){t(this).next(".llms-merge-codes").toggleClass("active")}),t(".llms-merge-codes li").on("click",function(){var e=t(this),a=e.closest(".llms-merge-codes"),n=a.attr("data-target"),l=e.attr("data-code");if(-1===n.indexOf("#")){var s=tinymce.editors[n];s?s.insertContent(l):alert(LLMS.l10n.translate("Copy this code and paste it into the desired area")+": "+l)}else t(n).val(t(n).val()+l);a.removeClass("active")})},this.bind_tabs=function(){t(".llms-nav-tab-wrapper .tabs li").on("click",function(){var e=t(this),a=e.closest(".llms-mb-container"),n=e.attr("data-tab");e.siblings().removeClass("llms-active"),a.find(".tab-content").removeClass("llms-active"),e.addClass("llms-active"),t("#"+n).addClass("llms-active")})},this.post_select=function(e){var a=e.attr("data-post-type")||post,n=e.attr("data-post-type")||!1;e.llmsSelect2({allowClear:n,ajax:{dataType:"JSON",delay:250,method:"POST",url:window.ajaxurl,data:function(t){return{action:"select2_query_posts",page:t.page?t.page-1:0,post_type:a,term:t.term,_ajax_nonce:wp_ajax_data.nonce}},processResults:function(e,a){return{results:t.map(e.items,function(t){return{text:t.name,id:t.id}}),pagination:{more:e.more}}}},cache:!0,width:"100%"})},this.bind_tables=function(){t('.llms-table button[name="llms-expand-table"]').on("click",function(){var e=t(this),a=e.closest(".llms-table");if(e.attr("data-text")){var n=e.text();e.text(e.attr("data-text")),e.attr("data-text",n)}a.find(".expandable").each(function(){t(this).hasClass("closed")?t(this).addClass("opened").removeClass("closed"):t(this).addClass("closed").removeClass("opened")})})},this.init()};window.llms.metaboxes=new e}(jQuery);